{{ define "main" }}
  {{/* Optional simple page handling */}}
  {{ $typeOfPage := .Params.type }}
  {{ if eq $typeOfPage "page" }}
    <h1 data-pagefind-meta="title">{{ .Title }}</h1>
    <div class="main-text-container">{{ .Content }}</div>
    {{ partial "go-to-top.html" . }}
  {{ else }}

  {{/* Cover image for posts if provided */}}
  {{ with .Params.cover }}
    {{ $cover := $.Resources.GetMatch .image }}
    {{ $displayImage := $.Params.cover.imageDisplay | default true }}
    {{ if and $cover $displayImage }}
      {{ $displayCaption := $.Params.cover.captionDisplay | default true }}
      <div class="post-cover">
        <img src="{{ $cover.RelPermalink }}" alt="{{ $.Params.cover.alt | default $.Title }}" />
        {{ if $displayCaption }}
          {{ with $.Params.cover.caption }}<p class="caption">{{ . }}</p>{{ end }}
        {{ end }}
      </div>
    {{ end }}
  {{ end }}

  <div data-pagefind-body>
    <h1 data-pagefind-meta="title">{{ .Title }}</h1>

    {{/* Metadata */}}
    {{ $showFrontMatter := .Params.showFrontMatter | default .Site.Params.posts.showFrontMatter }}
    {{ if $showFrontMatter }}
      {{ $readingTime := div (float .WordCount) .Site.Params.posts.readingSpeed }}
      {{ $readingTime = math.Ceil $readingTime }}
      <div class="metadata">
        {{ if .Site.Params.posts.showTags }}{{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}{{ end }}
        {{ if .Site.Params.posts.showCategories }}{{ partial "terms.html" (dict "taxonomy" "categories" "page" .) }}{{ end }}
        {{ if .Site.Params.posts.showAuthors }}{{ partial "terms.html" (dict "taxonomy" "authors" "page" .) }}{{ end }}
        {{ if .Site.Params.posts.showDate }}
          {{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
          {{ $dateHuman := .Date | time.Format .Site.Params.posts.dateFormat }}
          <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>
        {{ end }}
        {{ if .Site.Params.posts.showWordCount }}<p>Words: {{ .WordCount }}</p>{{ end }}
        {{ if .Site.Params.posts.showReadingTime }}<p>Reading Time: {{ $readingTime }} mins</p>{{ end }}
      </div>
    {{ end }}

    {{ if eq .Params.toc true }}{{ partial "toc.html" . }}{{ end }}

    {{ $showTagCloud := .Site.Params.posts.showTagCloud }}
    {{ $showCategoryCloud := .Site.Params.posts.showCategoryCloud }}
    {{ $showAuthorCloud := .Site.Params.posts.showAuthorCloud }}
    {{ if or $showTagCloud $showCategoryCloud $showAuthorCloud }}
      <div class="taxo-clouds">
        <div class="tag-cloud">
          {{ if .Site.Params.posts.showTagCloud }}
          <h2>TAGS</h2>
          {{ partial "taxocloud.html" (dict "taxonomy" "tags") }}
          {{ end }}
        </div>
        <div class="category-cloud">
          {{ if .Site.Params.posts.showCategoryCloud }}
          <h2>CATEGORIES</h2>
          {{ partial "taxocloud.html" (dict "taxonomy" "categories") }}
          {{ end }}
        </div>
        <div class="author-cloud">
          {{ if .Site.Params.posts.showAuthorCloud }}
          <h2>AUTHORS</h2>
          {{ partial "taxocloud.html" (dict "taxonomy" "authors") }}
          {{ end }}
        </div>
      </div>
    {{ end }}

    <div class="main-text-container">{{ .Content }}</div>
  </div>

  {{/* Prev/Next navigation */}}
  {{ $pages := .CurrentSection.Pages.ByWeight }}
  <div class="prev-next-div">
    <div class="prev-link">
      {{ with $pages.Prev . }}
      <a href="{{ .RelPermalink }}">← Previous: {{ .LinkTitle }}</a>
      {{ end }}
    </div>
    <div class="next-link">
      {{ with $pages.Next . }}
      <a href="{{ .RelPermalink }}">Next: {{ .LinkTitle }} →</a>
      {{ end }}
    </div>
  </div>

  {{ if .Site.Params.giscus.enable }}{{ partial "github-comments.html" . }}{{ end }}
  {{ partial "go-to-top.html" . }}
  {{ end }}
{{ end }}
